<canvas id="ctx" width="500" height="500" style="border:1px solid #000000;"></canvas>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>
<script>
	var ctx = document.getElementById("ctx").getContext("2d");
	ctx.font = '15px Arial';
	
	var socket = io();
	
	var username = prompt("Ingresa tu nickname.");
	
	socket.emit('name', {name:username});
	
	var MAX_X_LENGHT = 500;
	var MAX_Y_LENGHT = 500;
	
	socket.on('newPositions', function(data){
		ctx.clearRect(0,0,MAX_X_LENGHT,MAX_Y_LENGHT);
		for(var i = 0; i < data.player.length; i++){
			ctx.fillText(data.player[i].name, data.player[i].x, data.player[i].y + 20);
		}
		for(var j = 0; j < data.ball.length; j++){
			ctx.fillRect(data.ball[j].x-5, data.ball[j].y-5, 10, 10);
		}
	});
	
	document.onkeydown = function(event){
		switch(event.keyCode){
			case 68: //d
				socket.emit('keyPress', {inputId:'right', state:true});
				break;
			case 83: //s
				socket.emit('keyPress', {inputId:'down', state:true});
				break;
			case 65: //a
				socket.emit('keyPress', {inputId:'left', state:true});
				break;
			case 87: //w
				socket.emit('keyPress', {inputId:'up', state:true});
				break;
			default:
				break;
		};
	}
	document.onkeyup = function(event){
		switch(event.keyCode){
			case 68: //d
				socket.emit('keyPress', {inputId:'right', state:false});
				break;
			case 83: //s
				socket.emit('keyPress', {inputId:'down', state:false});
				break;
			case 65: //a
				socket.emit('keyPress', {inputId:'left', state:false});
				break;
			case 87: //w
				socket.emit('keyPress', {inputId:'up', state:false});
				break;
			default:
				break;
		};
	}
	
	document.onmousedown = function(event){
		socket.emit('keyPress', {inputId:'attack', state:true});
	}
	
	document.onmouseup = function(event){
		socket.emit('keyPress', {inputId:'attack', state:false});
	}
	
	document.onmousemove= function(event){
		var x = -250 + event.clientX - 8;
		var y = -250 + event.clientY - 8;
		var angle = Math.atan2(y,x)/Math.PI * 180;
		socket.emit('keyPress', {inputId:'mouseAngle', state:angle});
	}
</script>
